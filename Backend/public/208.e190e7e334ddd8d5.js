"use strict";(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[208],{3208:(J,c,l)=>{l.r(c),l.d(c,{CallModule:()=>A});var d=l(9808),r=l(9291),h=l(8187),p=l(7579),v=l(9300),m=l(2340),e=l(5e3),g=l(9812),u=l(273),f=l(263),C=l(4118);function x(t,n){1&t&&(e.TgZ(0,"div",5)(1,"h3"),e._uU(2,"Call ended"),e.qZA(),e.TgZ(3,"p",6),e._UZ(4,"i",7),e._uU(5,"Home"),e.qZA()())}function _(t,n){if(1&t&&e._UZ(0,"video",18,19),2&t){const i=e.oxw(3);e.Q6J("srcObject",i.remoteStream)}}function O(t,n){if(1&t&&e._UZ(0,"video",20,21),2&t){const i=e.oxw(3);e.Q6J("srcObject",i.currentStream)("muted",!0)}}function b(t,n){if(1&t&&(e.TgZ(0,"div",15),e.YNc(1,_,2,1,"video",16),e.YNc(2,O,2,2,"video",17),e.qZA()),2&t){const i=e.oxw(2),o=e.MAs(4);e.xp6(1),e.Q6J("ngIf",i.answered)("ngIfElse",o),e.xp6(1),e.Q6J("ngIf",i.currentStream)}}function M(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11),e.YNc(4,b,3,3,"div",12),e.qZA()()()(),e.TgZ(5,"div",13),e.NdJ("click",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.callEnd())}),e._UZ(6,"i",14),e.qZA()}if(2&t){const i=e.oxw(),o=e.MAs(6);e.xp6(4),e.Q6J("ngIf","video"==(null==i.dataPeer?null:i.dataPeer.type))("ngIfElse",o)}}function P(t,n){1&t&&(e.TgZ(0,"p",22),e._uU(1,"Calling..."),e.qZA())}function y(t,n){if(1&t&&(e.TgZ(0,"div",26),e._UZ(1,"video",27,28),e.qZA()),2&t){const i=e.oxw(2);e.xp6(1),e.Q6J("srcObject",i.remoteStream)}}function w(t,n){if(1&t&&(e.TgZ(0,"div",29),e._UZ(1,"video",30,31),e.qZA()),2&t){const i=e.oxw(2);e.xp6(1),e.Q6J("srcObject",i.currentStream)("muted",!0)}}function S(t,n){if(1&t&&(e.TgZ(0,"div",23),e.YNc(1,y,3,1,"div",24),e.YNc(2,w,3,2,"div",25),e.qZA()),2&t){const i=e.oxw(),o=e.MAs(4);e.xp6(1),e.Q6J("ngIf",i.answered)("ngIfElse",o),e.xp6(1),e.Q6J("ngIf",i.currentStream)}}const I=[{path:"",component:(()=>{class t{constructor(i,o,a,T,j){this.route=i,this.router=o,this.callService=a,this.socketService=T,this.authService=j,this.answered=!1,this.finished=!1,this.eventOpenAlert=new p.x,this.checkMediaDevices=()=>{navigator&&navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:"video"==this.dataPeer.type}).then(s=>{this.currentStream=s,this.runPeer()}).catch(()=>{(0,h.O1)(this.eventOpenAlert,"Could not access audio or video. Can't continue")}):(0,h.O1)(this.eventOpenAlert,"It does not have an audio or video device. Can't continue")},this.user=this.authService.getMyUser(),this.callService.remoteStream$.pipe((0,v.h)(s=>!!s)).subscribe(s=>{this.activeRemoteVideo(s)}),this.loadPeer()}ngOnInit(){}ngOnDestroy(){var i;null===(i=this.subListenCallEnd)||void 0===i||i.unsubscribe(),this.callEnd()}listenCallEnd(){this.subListenCallEnd=this.socketService.listen(m.N.events.CALL_ENDED).subscribe(i=>{this.callEnd(!0)})}loadPeer(){this.peerId=this.route.snapshot.paramMap.get("idPeer"),this.callService.getPeer(this.peerId).subscribe(i=>{this.dataPeer=i,this.checkMediaDevices()},i=>{this.callEnd()})}runPeer(){this.dataPeer.connected[0]!=this.user._id?this.dataPeer.connected.length<1?(console.log("PEEERID",this.peerId),this.callService.initPeer(this.peerId),console.log("enviando call"),this.sendCall()):(console.log("reciviendo call",this.dataPeer),this.callService.initPeer(this.dataPeer.id),this.enterCall()):this.callEnd()}sendCall(){this.callService.sendCall(this.peerId).subscribe(i=>{this.callService.enableCallAnswer(this.currentStream),this.listenCallEnd()})}enterCall(){console.log(this.dataPeer),this.callService.establishMediaCall(this.peerId,this.currentStream),this.listenCallEnd()}activeRemoteVideo(i){this.remoteStream=i,this.answered=!0}callEnd(i=!1){var o;this.callService.closeMediaCall(this.currentStream),this.callService.destroyPeer(),null===(o=this.currentStream)||void 0===o||o.getTracks().forEach(a=>{a.stop()}),this.currentStream=null,i?this.finished=!0:(this.callService.deleteCall(this.peerId).subscribe(a=>{this.router.navigate(["/"])}),this.router.navigate(["/"]))}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(r.gz),e.Y36(r.F0),e.Y36(g.M),e.Y36(u.$),e.Y36(f.e))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-call"]],decls:8,vars:3,consts:[["id","finished_call",4,"ngIf","ngIfElse"],["noFinished",""],["calling",""],["voice",""],[3,"eventOpenAlert"],["id","finished_call"],["routerLink","/"],[1,"fas","fa-home-lg-alt"],["id","people"],[1,"container-fluid"],[1,"row"],[1,"col","text-center"],["id","video-wrapper",4,"ngIf","ngIfElse"],["id","finish",3,"click"],[1,"fas","fa-phone-slash"],["id","video-wrapper"],["id","remote-video","poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject",4,"ngIf","ngIfElse"],["id","local-video","autoplay","","playsinline","",3,"srcObject","muted",4,"ngIf"],["id","remote-video","poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject"],["remoteVideo",""],["id","local-video","autoplay","","playsinline","",3,"srcObject","muted"],["localVideo",""],[1,"calling"],["id","video-wrapper onlyVoice"],["id","remote-voice",4,"ngIf","ngIfElse"],["id","local-voice",4,"ngIf"],["id","remote-voice"],["poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject"],["remoteVoice",""],["id","local-voice"],["autoplay","","playsinline","",3,"srcObject","muted"],["localVoice",""]],template:function(i,o){if(1&i&&(e.YNc(0,x,6,0,"div",0),e.YNc(1,M,7,2,"ng-template",null,1,e.W1O),e.YNc(3,P,2,0,"ng-template",null,2,e.W1O),e.YNc(5,S,3,3,"ng-template",null,3,e.W1O),e._UZ(7,"app-mini-alert",4)),2&i){const a=e.MAs(2);e.Q6J("ngIf",o.finished)("ngIfElse",a),e.xp6(7),e.Q6J("eventOpenAlert",o.eventOpenAlert.asObservable())}},dependencies:[d.O5,r.rH,C.O],styles:['[_nghost-%COMP%]{position:absolute;width:100vw;height:100vh;top:0;left:0;z-index:400;background:#343434;max-width:100%}#video-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#343434;border-radius:4px}#remote-video[_ngcontent-%COMP%]{max-width:100%;max-height:90vh;border-radius:4px;border:3px solid #fff;width:85vw;height:85vh;background:#000}#local-video[_ngcontent-%COMP%]{z-index:1;position:absolute;right:1.5rem;bottom:1.5rem;width:25vw;height:20vw;max-width:20rem;max-height:20rem;border:3px solid white;border-radius:4px;min-width:200px;height:150px;background:#000}#remote-voice[_ngcontent-%COMP%]{max-width:100%;max-height:90vh;border-radius:4px;border:3px solid #fff;width:85vw;height:85vh;background:#000}#remote-voice[_ngcontent-%COMP%]:before{content:"Conectado";display:flex;justify-content:center;align-items:center;height:100%;font-size:40px;color:#fff}#local-voice[_ngcontent-%COMP%]{z-index:1;position:absolute;right:1.5rem;bottom:1.5rem;width:25vw;height:20vw;max-width:20rem;max-height:20rem;border:3px solid white;border-radius:4px;min-width:200px;height:150px;background:#000}#local-voice[_ngcontent-%COMP%]:before{content:"Conectado";display:flex;justify-content:center;align-items:center;height:100%;font-size:25px;color:#fff}#people[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:center;align-items:center}#finish[_ngcontent-%COMP%]{background:#eb0707;position:absolute;top:4px;right:4px;transform:scale(2);padding:9px;border-radius:10px 0 0 25px;cursor:pointer}.calling[_ngcontent-%COMP%]{font-size:10vw}#finished_call[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}#finished_call[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:3em}#finished_call[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:25px;margin-top:10px!important;color:#d9d9d9;cursor:pointer;display:flex;align-items:end}#finished_call[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}']}),t})()}];let E=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[r.Bz.forChild(I),r.Bz]}),t})();var Z=l(4466);let A=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[d.ez,E,Z.m]}),t})()}}]);