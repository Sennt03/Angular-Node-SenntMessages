"use strict";(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[414],{2414:(R,p,r)=>{r.r(p),r.d(p,{CallModule:()=>N});var h=r(9808),c=r(9291),u=r(8187),v=r(7579),f=r(9300),C=r(2340);const m={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let d;const x=new Uint8Array(16);function _(){if(!d&&(d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(x)}const l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));const b=function y(t,i,n){if(m.randomUUID&&!i&&!t)return m.randomUUID();const o=(t=t||{}).random||(t.rng||_)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,i){n=n||0;for(let a=0;a<16;++a)i[n+a]=o[a];return i}return function g(t,i=0){return(l[t[i+0]]+l[t[i+1]]+l[t[i+2]]+l[t[i+3]]+"-"+l[t[i+4]]+l[t[i+5]]+"-"+l[t[i+6]]+l[t[i+7]]+"-"+l[t[i+8]]+l[t[i+9]]+"-"+l[t[i+10]]+l[t[i+11]]+l[t[i+12]]+l[t[i+13]]+l[t[i+14]]+l[t[i+15]]).toLowerCase()}(o)};var e=r(5e3),O=r(9812),w=r(273),M=r(263),S=r(4118);function I(t,i){1&t&&(e.TgZ(0,"div",5)(1,"h3"),e._uU(2,"Call ended"),e.qZA(),e.TgZ(3,"p",6),e._UZ(4,"i",7),e._uU(5,"Home"),e.qZA()())}function P(t,i){if(1&t&&e._UZ(0,"video",18,19),2&t){const n=e.oxw(3);e.Q6J("srcObject",n.remoteStream)}}function U(t,i){if(1&t&&e._UZ(0,"video",20,21),2&t){const n=e.oxw(3);e.Q6J("srcObject",n.currentStream)("muted",!0)}}function E(t,i){if(1&t&&(e.TgZ(0,"div",15),e.YNc(1,P,2,1,"video",16),e.YNc(2,U,2,2,"video",17),e.qZA()),2&t){const n=e.oxw(2),o=e.MAs(4);e.xp6(1),e.Q6J("ngIf",n.answered)("ngIfElse",o),e.xp6(1),e.Q6J("ngIf",n.currentStream)}}function Z(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11),e.YNc(4,E,3,3,"div",12),e.qZA()()()(),e.TgZ(5,"div",13),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.callEnd())}),e._UZ(6,"i",14),e.qZA()}if(2&t){const n=e.oxw(),o=e.MAs(6);e.xp6(4),e.Q6J("ngIf","video"==(null==n.dataPeer?null:n.dataPeer.type))("ngIfElse",o)}}function A(t,i){1&t&&(e.TgZ(0,"p",22),e._uU(1,"Calling..."),e.qZA())}function T(t,i){if(1&t&&(e.TgZ(0,"div",26),e._UZ(1,"video",27,28),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("srcObject",n.remoteStream)}}function j(t,i){if(1&t&&(e.TgZ(0,"div",29),e._UZ(1,"video",30,31),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("srcObject",n.currentStream)("muted",!0)}}function D(t,i){if(1&t&&(e.TgZ(0,"div",23),e.YNc(1,T,3,1,"div",24),e.YNc(2,j,3,2,"div",25),e.qZA()),2&t){const n=e.oxw(),o=e.MAs(4);e.xp6(1),e.Q6J("ngIf",n.answered)("ngIfElse",o),e.xp6(1),e.Q6J("ngIf",n.currentStream)}}const J=[{path:"",component:(()=>{class t{constructor(n,o,a,Q,V){this.route=n,this.router=o,this.callService=a,this.socketService=Q,this.authService=V,this.answered=!1,this.finished=!1,this.eventOpenAlert=new v.x,this.checkMediaDevices=()=>{navigator&&navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:"video"==this.dataPeer.type}).then(s=>{this.currentStream=s,this.runPeer()}).catch(()=>{(0,u.O1)(this.eventOpenAlert,"Could not access audio or video. Can't continue")}):(0,u.O1)(this.eventOpenAlert,"It does not have an audio or video device. Can't continue")},this.user=this.authService.getMyUser(),this.callService.remoteStream$.pipe((0,f.h)(s=>!!s)).subscribe(s=>{this.activeRemoteVideo(s)}),this.loadPeer()}ngOnInit(){}ngOnDestroy(){var n;null===(n=this.subListenCallEnd)||void 0===n||n.unsubscribe(),this.callEnd()}listenCallEnd(){this.subListenCallEnd=this.socketService.listen(C.N.events.CALL_ENDED).subscribe(n=>{this.callEnd(!0)})}loadPeer(){this.peerId=this.route.snapshot.paramMap.get("idPeer"),this.callService.getPeer(this.peerId).subscribe(n=>{this.dataPeer=n,this.checkMediaDevices()},n=>{this.callEnd()})}runPeer(){this.dataPeer.connected[0]!=this.user._id?this.dataPeer.connected.length<1?(this.callService.initPeer(this.peerId),console.log("enviando call"),this.sendCall()):(console.log("reciviendo call"),this.callService.initPeer(b()),this.enterCall()):this.callEnd()}sendCall(){this.callService.sendCall(this.peerId).subscribe(n=>{this.callService.enableCallAnswer(this.currentStream),this.listenCallEnd()})}enterCall(){console.log(this.dataPeer),this.callService.establishMediaCall(this.peerId,this.currentStream),this.listenCallEnd()}activeRemoteVideo(n){this.remoteStream=n,this.answered=!0}callEnd(n=!1){var o;this.callService.closeMediaCall(this.currentStream),this.callService.destroyPeer(),null===(o=this.currentStream)||void 0===o||o.getTracks().forEach(a=>{a.stop()}),this.currentStream=null,n?this.finished=!0:(this.callService.deleteCall(this.peerId).subscribe(a=>{this.router.navigate(["/"])}),this.router.navigate(["/"]))}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(c.gz),e.Y36(c.F0),e.Y36(O.M),e.Y36(w.$),e.Y36(M.e))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-call"]],decls:8,vars:3,consts:[["id","finished_call",4,"ngIf","ngIfElse"],["noFinished",""],["calling",""],["voice",""],[3,"eventOpenAlert"],["id","finished_call"],["routerLink","/"],[1,"fas","fa-home-lg-alt"],["id","people"],[1,"container-fluid"],[1,"row"],[1,"col","text-center"],["id","video-wrapper",4,"ngIf","ngIfElse"],["id","finish",3,"click"],[1,"fas","fa-phone-slash"],["id","video-wrapper"],["id","remote-video","poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject",4,"ngIf","ngIfElse"],["id","local-video","autoplay","","playsinline","",3,"srcObject","muted",4,"ngIf"],["id","remote-video","poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject"],["remoteVideo",""],["id","local-video","autoplay","","playsinline","",3,"srcObject","muted"],["localVideo",""],[1,"calling"],["id","video-wrapper onlyVoice"],["id","remote-voice",4,"ngIf","ngIfElse"],["id","local-voice",4,"ngIf"],["id","remote-voice"],["poster","./assets/video-placeholder.jpg","autoplay","","playsinline","",3,"srcObject"],["remoteVoice",""],["id","local-voice"],["autoplay","","playsinline","",3,"srcObject","muted"],["localVoice",""]],template:function(n,o){if(1&n&&(e.YNc(0,I,6,0,"div",0),e.YNc(1,Z,7,2,"ng-template",null,1,e.W1O),e.YNc(3,A,2,0,"ng-template",null,2,e.W1O),e.YNc(5,D,3,3,"ng-template",null,3,e.W1O),e._UZ(7,"app-mini-alert",4)),2&n){const a=e.MAs(2);e.Q6J("ngIf",o.finished)("ngIfElse",a),e.xp6(7),e.Q6J("eventOpenAlert",o.eventOpenAlert.asObservable())}},dependencies:[h.O5,c.rH,S.O],styles:['[_nghost-%COMP%]{position:absolute;width:100vw;height:100vh;top:0;left:0;z-index:400;background:#343434;max-width:100%}#video-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#343434;border-radius:4px}#remote-video[_ngcontent-%COMP%]{max-width:100%;max-height:90vh;border-radius:4px;border:3px solid #fff;width:85vw;height:85vh;background:#000}#local-video[_ngcontent-%COMP%]{z-index:1;position:absolute;right:1.5rem;bottom:1.5rem;width:25vw;height:20vw;max-width:20rem;max-height:20rem;border:3px solid white;border-radius:4px;min-width:200px;height:150px;background:#000}#remote-voice[_ngcontent-%COMP%]{max-width:100%;max-height:90vh;border-radius:4px;border:3px solid #fff;width:85vw;height:85vh;background:#000}#remote-voice[_ngcontent-%COMP%]:before{content:"Conectado";display:flex;justify-content:center;align-items:center;height:100%;font-size:40px;color:#fff}#local-voice[_ngcontent-%COMP%]{z-index:1;position:absolute;right:1.5rem;bottom:1.5rem;width:25vw;height:20vw;max-width:20rem;max-height:20rem;border:3px solid white;border-radius:4px;min-width:200px;height:150px;background:#000}#local-voice[_ngcontent-%COMP%]:before{content:"Conectado";display:flex;justify-content:center;align-items:center;height:100%;font-size:25px;color:#fff}#people[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:center;align-items:center}#finish[_ngcontent-%COMP%]{background:#eb0707;position:absolute;top:4px;right:4px;transform:scale(2);padding:9px;border-radius:10px 0 0 25px;cursor:pointer}.calling[_ngcontent-%COMP%]{font-size:10vw}#finished_call[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}#finished_call[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:3em}#finished_call[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:25px;margin-top:10px!important;color:#d9d9d9;cursor:pointer;display:flex;align-items:end}#finished_call[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}']}),t})()}];let Y=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[c.Bz.forChild(J),c.Bz]}),t})();var z=r(4466);let N=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.ez,Y,z.m]}),t})()}}]);